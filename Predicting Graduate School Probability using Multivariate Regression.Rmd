---
title: "Predictors Of Graduate School Acceptance Probability"
author: "Siyabonga Mabuza & Chilekwa Lingoma"
date: "10/29/2021"
output:
  word_document: default
  html_document: default
toc: yes
---
# Abstract

This report examines graduate school acceptance probability as a function of several predictor variables such as College GPA, Graduate Record Examination, TOEFL, Statement of Purpose, and Letter Recommendation. The aim of this report is to build a linear regression model which can predict the graduate school acceptance probability with a suitable amount of precision to understand to the extent of each predictor's relation to graduate school acceptance probability. 

The prediction interval we would expect from our final model is 94.5%. Thus, we would expect and accuracy of approximately 95%.  This model suggests that CGPA is the most significant predictor towards graduate school admission. 

# Introduction 

Upon completing their college education, college graduates often consider graduate school as a means to further their education. This report examines data on 400 college graduates from India. The primary goal of this report is to determine what factors are the most predictive of US graduate school acceptance probability (Chance of Admission) measured from a scale of 0-1. Moreover, this report aims to understand how the predictors are related to graduate school chance of admission. The predictor variables include:

•	Graduate Record Examination (GRE) Score (out of 340)

•	TOEFL Score (out of 120)

•	Statement Of Purpose (SOP) (ranging from 1-5)

•	Letter Of Recommendation (LOR) (ranging from 1-5)

•	College GPA (CGPA) (out of 9.92)

Firstly, a basic level of investigative analysis was undertaken to understand the distribution of each variable and their pairwise correlations. Furthermore, we also checked for obvious outliers and considered whether to transform any obviously skewed variables.

We will examine the association of each predictor variable to the chance of admission to determine the strength and direction of each association.  A first-order model will then be fitted with all of the predictor variables coupled with residual analysis and coefficient tests. This will dictate how we proceed with our analysis. The goal is to find a model with an optimum level of fitness while using the fewest number of predictors as possible.  

The investigation will then potentially determine which predictor has the highest significance to US graduate school acceptance for any Indian college student wishing to further their education in the United States. Our hypothesis is: College GPA is the predictor with the largest significance to US graduate chance of admission. Generally, the higher the College GPA the higher the chance of admission. What concerns us with this hypothesis is the subjectivity associated with how each graduate institution values College GPA. Some institutions may only value College GPA while others may value College GPA as well as other predictors (TOEFL Score, Letter of Recommendation etc.) Some of the other predictors may even be more significant to chance of admission than College GPA. This reports seeks to examine if this is true or not. 

# Exploratory Analysis

```{r}
library(readxl)
US_graduate_scaled <- read_excel("C:/Users/Siyabonga Mabuza/Desktop/Admissions dataset.xlsx")
head(US_graduate_scaled)
```

# The Distributions of the quantitative predictor variables:

```{r}
library(ggplot2)
library(tidyr)

ggplot(gather(US_graduate_scaled [, 2:8]), aes(value)) +
  geom_histogram(bins = 8) +
  facet_wrap(~key, scales = "free_x")

```

None of the predictor variables seem to be extremely right or left skewed. Thus, no transformations are necessary. 

# Pairwise Correlations.

We will now examine pairwise correlations. 

```{r}
plot (US_graduate_scaled)
```

```{r}
cormat = cor (US_graduate_scaled [,2:8])
round (cormat, 2)
```

The pairwise correlations plot shows the linear relationships between Chance of Admission and GRE, CGPA, TOEFL, SOP, University Rating, and LOR. College GPA has the highest correlation with chance of admission (r=0.87). GRE score (r=0.80) and TOEFL score (r=0.79) also have relatively high correlations with chance of admission.

Three predictors, CGPA, GRE score, and TOEFL scores are highly correlated with each other (r=0.83 to 0.84)

# Model 1

The first model will include all of the individual predictors. 

# First Order Model With All Predictors.
 
A first-order model will now be fitted with all of the individual predictors. 

```{r}
fit1 = lm (`Chance of Admission` ~ CGPA + LOR + SOP +  `GRE Score`+ `TOEFL Score`+ `University Rating` , data=US_graduate_scaled)
summary (fit1)

```

```{r}
anova (fit1)
```
 
The analysis of the variance table suggests that all but SOP are significant predictors. CGPA and GRE scores are the most significant predictors. Between the significant predictors TOEFL seems to have the lowest significance. The coefficient tests suggest that all predictors except SOP and University Rating are significant. CGPA has the highest significance, followed by GRE. SOP has the lowest significance followed by the TOEFL score. The adjusted R-squared is 0.7956, this indicates that 79.56% of the variability in chance of admission is explained by this model. The residual standard error is 0.06447 probability this is okay relative to the range of chance of admission values (0.34 to 0.97 probability)

# Residual Anaysis- First-order Model.

```{r}
par (mfrow=c(1,2))
plot(fit1)
```

• The Residuals vs Fitted plot shows good elements of linearity and constant variance. However, there is a slight curvature and the residual variance seems to be slightly decreasing with increasing fitted values. Thus, linearity and variance need can be improved. 

• The Normal Q-Q plot shows that residuals relatively follow a normal distribution.There is some left skewness, this can be improved with a transformation.  

• The Scale-Location plot shows a slight amount of decreasing residual variance with increasing fitted values. This can be improved with a transformation. 

• The Residuals vs Leverage plot shows that there are some outliers and possible high leverage values.This can be improved with a transformation. 

Due to the aforementioned concerns we will run a Box-Cox analysis to find a power transformation that potentially addresses our concerns with the residuals. 

# Box-Cox Anaysis

```{r}
MASS::boxcox (fit1, lambda=c(-3, 3, by=0.1)) 
```

The Box-cox indicates that an optimal transformation would have a power close to 2.5, therefore, we will use a chance of admission^2.5 transformation.

# Model 2 - Cube of Chance of Admission vs. All Predictors

The power to 2.5 transformation will now be re-fitted into the first-order model with all of the predictor variables. 

```{r}
fit2 = lm((`Chance of Admission`)^2.5 ~ (CGPA) + (LOR) + (SOP) + (`GRE Score`) +
(`TOEFL Score`)+ (`University Rating`), data=US_graduate_scaled)
summary(fit2)
```

This model explains 83.06% of the variation in chance of admission^2.5. The residual standard error is 0.08835 probability^2.5. 

```{r}
par (mfrow=c(1,2))
plot(fit2)
```

The residuals for model 2 compared to model 1 look slightly better, there is a more uniform spread. The normal Q-Q graph in particular is slightly better in this new model compared to model 1 but there is some left skewness, the residuals now have an improved normal distribution. However, Rows 10, 65, 66 are still obvious outliers. 

CGPA seems to be the most significant predictor in this model followed by GRE Score and TOEFL Score. SOP has no statistical significance (P=0.997). Generally, all of the predictors have positive slopes. Thus, an increase in each predictor does increase the chance of admission, the extent of the increase in chance of admission depends on which predictor is increased. 


```{r}
confint(fit2)
```

• Average chance of admission^2.5 increases between 0.139 and 0.205 per CGPA with 95% confidence with other predictors held constant.

• Average chance of admission^2.5 increases between 0.012 and 0.0426 per LOR with 95% confidence with other predictors held constant.

• Average chance of admission^2.5 increases between -0.015 and 0.015 per SOP with 95% confidence with other predictors held constant.

• Average chance of admission^2.5 increases between 0.002 and 0.005 per GRE Score with 95% confidence with other predictors held constant.

•Average chance of admission^2.5 increases between 0.001 and 0.007 per TOEFL Score with 95% confidence with other predictors held constant.

•Average chance of admission^2.5 increases between 0.004 and 0.030 per University Rating with 95% confidence with other predictors held constant.

# Model 3- Remove Non-Significant Predictors. 

Stepwise regression will now be applied to the chance of admission^2.5 model using the AIC criterion. 

```{r}
Fit2sqaic = step(fit2, direction = 'both')
```

The results indicate that SOP can be removed from the model. 

# Interactions

New centered predictors will now be created for each predictor. 

```{r}
CGPA.c= scale(US_graduate_scaled$CGPA, center = TRUE, scale = FALSE)
LOR.c= scale(US_graduate_scaled$LOR, center = TRUE, scale = FALSE)
`GRE Score.c`= scale(US_graduate_scaled$`GRE Score`, center = TRUE, scale = FALSE)
`TOEFL Score.c`= scale(US_graduate_scaled$`TOEFL Score`, center = TRUE, scale = FALSE)
`University Rating.c`= scale(US_graduate_scaled$`University Rating`, center = TRUE, scale = FALSE)
```

Now, we will add all possible two-way interaction effects to the stepwise regression model obtained above. 

```{r}
fit2sbc.int = lm ((`Chance of Admission`)^2.5 ~ (CGPA.c+ LOR.c + `GRE Score.c`+ `TOEFL Score.c`+ `University Rating.c`)^2, data=US_graduate_scaled)
summary (fit2sbc.int)

```

Model 3 has a slightly higher adjusted R squared at 0.8469 compared to model 2 at 0.83. Furthermore, the residual standard error is lower (0.0840 vs. 0.0922).

# Model 4- Step Wise Regression With Centered Interaction Effects. 

Now we will apply step wise regression to the model with the centered interaction effects from step 3.

```{r}
fit2sbc.int2= step (fit2sbc.int, direction='both')
```

```{r}
summary (fit2sbc.int2)
```

four interactions were retained using this criterion. CGPA.c:TOEFL Score.c, LOR.c:TOEFL Score.c, LOR.c:TOEFL Score.c, and LOR.c:University Rating.c. Meaning that the slope between chance of admission ^2.5 and CPA is different for different levels of TOEFL Score. Furthermore, the slope between chance of admission ^2.5 and LOR and is different for different levels of TOEFL Score and University Rating. 

```{r}
summary(fit2sbc.int2)
```

The adjusted R-square and residual standard error basically remained the same. Adjusted R-squared (0.8487 vs. 0.8469). Residual standard error (0.08349 vs. 0.08399) 

# Final Model

The model above appears to be our final model. 

# Residual and Influence Anaysis

Next, we will examine the residuals vs fitted plot, the QQ plot, the square root of absolute standardized residuals vs fitted plot and the standardized residuals vs leverage, with Cook’s distance to understand the residuals of our final model.

```{r}
plot(fit2sbc.int2)
```

The residuals vs fitted plot shows good constant variance. The Normal Q-Q plot shows a mostly normal distribution and is only slightly left skewed. Square root of absolute standardized residuals vs fitted values plot equally looks good, with a slightly wider spread of residuals it does not show much evidence of issues within the data. The residuals vs leverage plot similarly shows good constant variance with some outliers but no points sitting outside cooks distance. However, there seems to be some high leverage values Thus, the data looks good enough for us to proceed. The students with serial numbers 10,65,66,67 are the obvious outliers illustrated by the plots. 

Now we fit a box plot of the residuals.

```{r}
boxplot(fit2sbc.int2$residuals, ylab="fit2sbc.int2 Residuals", horizontal = T)
```

The box plot is asymmetric with several outliers which is not shocking because the residuals vs leverage plot showed that there are some outliers to be expected. 

Next, we will plot chances of admission vs. fitted values. 

```{r}
plot ((`Chance of Admission`)^2.5 ~ fit2sbc.int2$fitted.values, data=US_graduate_scaled) 
abline(0,1)
```

The plot of cube chance of admission vs. fitted values shows relatively a good fit. There seems to be numerous outliers.  

Next, we will examine variance inflation factors (vif).

```{r}
car:: vif (fit2sbc.int2)
```

The VIF values all seem okay except CGPA.c which also happens to be our most significant predictor. CGPA may be strongly impacting the other individual variables and their predictive power, however, because it is our most significant predictor, we will not drop it. GRE Score.c and 4.268423 also have relatively high VIFs but they are below the 5 limit. 

We will calculate the high leverage cutoff using the equation 3(k+1)/n. Our cut off is 3(4+1)/400 = 0.0375. Any values greater than 0.0375 are high leverage points.  

```{r}
par (mfrow=c(1,2))
plot(fit2sbc.int2) 
abline(v=0.0375, col="blue")
abline(h =3, col = "darkgreen")
abline(h =-3, col = "darkgreen")
```

There is a significant amount of high leverage values.  There do not seem to be to be any points with high Cook's distance. There are five outliers as illustrated by the horizontal lines in the residuals vs leverage plot. 

# Interaction Plot

Below are the plots of two of our interaction effects. (There are four in total we will show only two)

```{r}
par (mfrow=c(1,1))
# Function to categorize a continuous variable into its quartiles
categorize = function (x) {
  quartiles = summary (x) [c(2, 3, 5)]
  result = rep ("Q1", length (x))
  result [which ((quartiles[1] < x) & (x <= quartiles [2]))] = "Q2"
  result [which ((quartiles[2] < x) & (x <= quartiles [3]))] = "Q3"
  result [which (quartiles[3] < x)] = "Q4"
  return (result)
}

```

```{r}
library (ggplot2)
library (dplyr)

with (US_graduate_scaled,
      qplot (x=CGPA.c, y=(`Chance of Admission`)^2.5, color=categorize(`TOEFL Score.c`)) +
        geom_smooth (method="lm"))
```

All three quartiles maintain a similar graidiant therefore, we can see from this plot that the higher the TOEFL Score, and CGPA the higher the chances of admittance. 

```{r}
library (ggplot2)
library (dplyr)

with (US_graduate_scaled,
      qplot (x=LOR.c, y=(`Chance of Admission`)^2.5, color=categorize(`TOEFL Score.c`)) +
        geom_smooth (method="lm"))
```

The plot indicates that with a higher LOR and TOEFL score ones chance of admittance is much higher. Quartile four (categorized in blue) indicates that with higher TOEFL Score and LOR ones chance of admission is greater than 0.50. There does not seem to be a trend in the slopes. 

# Conclusions.

Our final model is:

Predicted cube chance of admission =  0.453 + 0.171 (CGPA) + 0.029 (LOR) + 0.003 (GRE SCORE) + 0.004 (TOEFL SCORE) + 0.015(University Rating) + 0.005 (CGPA)(TOEFL SCORE) - 0.002 (LOR)(TOEFL SCORE) + 0.004 (LOR)(UNIVERSITY RATING). 0.001(GRE SCORE)((UNIVERSITY RATING))

Since there are interaction effects between CGPA and TOEFL SCORE; LOR and TOEFL SCORE; LOR and UNIVERSITY RATING, we cannot numerically interpret a single slope for chance of admission^2.5 vs CGPA and LOR. Instead, we note from the interaction plots above that the relationship between chance of admission and CGPA is stronger when an applicant has a higher TOEFL SCORE. Furthermore, the relationship between chance of admission and LOR is stronger when an applicant has a higher TOEFL SCORE or University Rating.   

The final model has adjusted R Squared of 0.8487, which means that 84.87% of the variation on chance of admission^2.5 is explained by the model. The residual standard error is 0.08349 probability^2.5.

To illustrate use of the model for prediction, we will show some example students applying to college and their predicted chance of admission:


```{r}
preds = predict (fit2sbc.int2, interval='prediction')
```

```{r}
US_graduate_scaled$pred.chance =(preds [,1])
US_graduate_scaled$pred.lower =(preds [,2])
US_graduate_scaled$pred.upper =(preds [,3])
US_graduate_scaled$chance.of.admission.new=US_graduate_scaled$`Chance of Admission`^2.5

US_graduate_scaled [c(1, 399, 78, 150, 250, 311),c("CGPA", "LOR", "GRE Score", "TOEFL Score","University Rating", "chance.of.admission.new", "pred.chance","pred.lower", "pred.upper" )]
```
```{r}
US_graduate_scaled$in.interval = ifelse (US_graduate_scaled$pred.lower <= US_graduate_scaled$chance.of.admission.new &
                              US_graduate_scaled$chance.of.admission.new <= US_graduate_scaled$pred.upper,
                              1, 0)
mean (US_graduate_scaled$in.interval)

```

All of the six example students whose predictions are shown above have prediction intervals that contain the observed chance of admission. Furthermore, the prediction interval we would expect from this model is 94.5%. 

This model suggests that CGPA is the most significant predictor towards graduate school admission, thus, confirming our hypothesis. 